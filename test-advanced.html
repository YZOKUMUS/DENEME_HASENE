<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® GeliÅŸmiÅŸ Oyun Testleri</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #764ba2;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: #764ba2;
            color: white;
        }
        
        .btn-secondary {
            background: #667eea;
            color: white;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .test-results {
            margin-top: 30px;
        }
        
        .test-category {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .test-category h3 {
            color: #764ba2;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .test-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            background: white;
            border-left: 4px solid #ddd;
        }
        
        .test-item.pass {
            border-left-color: #10b981;
            background: #d1fae5;
        }
        
        .test-item.fail {
            border-left-color: #ef4444;
            background: #fee2e2;
        }
        
        .test-item.warning {
            border-left-color: #f59e0b;
            background: #fef3c7;
        }
        
        .test-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 8px;
        }
        
        .test-details {
            font-size: 14px;
            color: #666;
            margin-top: 8px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            background: rgba(0,0,0,0.05);
            padding: 10px;
            border-radius: 4px;
        }
        
        .summary {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: rgba(255,255,255,0.8);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #764ba2;
            font-weight: 600;
        }
        
        .warning-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® GeliÅŸmiÅŸ Oyun Testleri</h1>
        <p class="subtitle">GerÃ§ek oyun senaryolarÄ± ve edge case testleri</p>
        
        <div class="warning-box">
            <strong>âš ï¸ Dikkat:</strong> Bu testler gerÃ§ek verileri deÄŸiÅŸtirebilir. Test Ã¶ncesi yedek alÄ±nmasÄ± Ã¶nerilir.
        </div>
        
        <div class="test-controls">
            <button class="btn-primary" onclick="runAllTests()">ğŸš€ TÃ¼m Testleri Ã‡alÄ±ÅŸtÄ±r</button>
            <button class="btn-secondary" onclick="clearResults()">ğŸ—‘ï¸ SonuÃ§larÄ± Temizle</button>
            <button class="btn-success" onclick="testPointsFlow()">ğŸ’° Puan AkÄ±ÅŸÄ±</button>
            <button class="btn-success" onclick="testBadgeFlow()">ğŸ† Rozet AkÄ±ÅŸÄ±</button>
            <button class="btn-success" onclick="testDailyTaskFlow()">ğŸ“‹ GÃ¶rev AkÄ±ÅŸÄ±</button>
            <button class="btn-success" onclick="testFirebaseSync()">ğŸ”¥ Firebase Senkronizasyon</button>
            <button class="btn-warning" onclick="testEdgeCases()">âš ï¸ Edge Cases</button>
            <button class="btn-warning" onclick="testPerformance()">âš¡ Performans</button>
            <button class="btn-danger" onclick="testDataIntegrity()">ğŸ”’ Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼</button>
        </div>
        
        <div id="progress-container" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%;">0%</div>
            </div>
        </div>
        
        <div id="test-results" class="test-results">
            <p style="color: #666;">Testleri baÅŸlatmak iÃ§in yukarÄ±daki butonlardan birine tÄ±klayÄ±n.</p>
        </div>
    </div>
    
    <!-- Ana proje dosyalarÄ±nÄ± yÃ¼kle -->
    <script src="js/config.js"></script>
    <script src="js/constants.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/firebase-config.js"></script>
    <script type="module" src="js/firebase-init.js"></script>
    <script src="js/api-service.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/points-manager.js"></script>
    <script src="js/game-core.js"></script>
    
    <script>
        let testResults = [];
        let currentTest = 0;
        let totalTests = 0;
        
        function addTestResult(category, name, status, details) {
            testResults.push({ category, name, status, details, timestamp: new Date() });
            displayResults();
        }
        
        function updateProgress() {
            const progressContainer = document.getElementById('progress-container');
            const progressFill = document.getElementById('progress-fill');
            
            if (totalTests > 0) {
                progressContainer.style.display = 'block';
                const percent = Math.round((currentTest / totalTests) * 100);
                progressFill.style.width = percent + '%';
                progressFill.textContent = percent + '%';
            } else {
                progressContainer.style.display = 'none';
            }
        }
        
        function displayResults() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';
            
            if (testResults.length === 0) {
                resultsDiv.innerHTML = '<p style="color: #666;">HenÃ¼z test Ã§alÄ±ÅŸtÄ±rÄ±lmadÄ±.</p>';
                return;
            }
            
            // Kategorilere gÃ¶re grupla
            const categories = {};
            testResults.forEach(result => {
                if (!categories[result.category]) {
                    categories[result.category] = [];
                }
                categories[result.category].push(result);
            });
            
            // Her kategori iÃ§in gÃ¶ster
            Object.keys(categories).forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'test-category';
                categoryDiv.innerHTML = `<h3>${category}</h3>`;
                
                categories[category].forEach(result => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = `test-item ${result.status.toLowerCase()}`;
                    
                    const icon = result.status === 'PASS' ? 'âœ…' : 
                                result.status === 'WARNING' ? 'âš ï¸' : 'âŒ';
                    
                    itemDiv.innerHTML = `
                        <div class="test-name">${icon} ${result.name}</div>
                        <div class="test-details">${result.details}</div>
                    `;
                    
                    categoryDiv.appendChild(itemDiv);
                });
                
                resultsDiv.appendChild(categoryDiv);
            });
            
            // Ã–zet istatistikler
            const stats = {
                total: testResults.length,
                passed: testResults.filter(r => r.status === 'PASS').length,
                failed: testResults.filter(r => r.status === 'FAIL').length,
                warnings: testResults.filter(r => r.status === 'WARNING').length
            };
            
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'summary';
            const successRate = stats.total > 0 
                ? Math.round((stats.passed / stats.total) * 100)
                : 0;
            
            summaryDiv.innerHTML = `
                <h3>ğŸ“Š Ã–zet Ä°statistikler</h3>
                <div class="summary-stats">
                    <div class="stat-item">
                        <div class="stat-value">${stats.total}</div>
                        <div class="stat-label">Toplam Test</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #10b981;">${stats.passed}</div>
                        <div class="stat-label">âœ… BaÅŸarÄ±lÄ±</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #f59e0b;">${stats.warnings}</div>
                        <div class="stat-label">âš ï¸ UyarÄ±</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #ef4444;">${stats.failed}</div>
                        <div class="stat-label">âŒ BaÅŸarÄ±sÄ±z</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${successRate}%</div>
                        <div class="stat-label">ğŸ“Š BaÅŸarÄ± OranÄ±</div>
                    </div>
                </div>
            `;
            
            resultsDiv.appendChild(summaryDiv);
        }
        
        // ============================================
        // GELÄ°ÅMÄ°Å TEST FONKSÄ°YONLARI
        // ============================================
        
        async function testPointsFlow() {
            console.log('ğŸ§ª Puan AkÄ±ÅŸÄ± Testi BaÅŸlatÄ±lÄ±yor...');
            currentTest = 0;
            totalTests = 5;
            
            try {
                // Test 1: BaÅŸlangÄ±Ã§ puanÄ±
                currentTest++;
                updateProgress();
                const initialStats = await window.loadUserStats();
                const initialPoints = initialStats?.total_points || 0;
                addTestResult('Puan AkÄ±ÅŸÄ±', 'BaÅŸlangÄ±Ã§ PuanÄ±', 'PASS', `âœ… BaÅŸlangÄ±Ã§ puanÄ±: ${initialPoints}`);
                
                // Test 2: Session puanÄ± ekleme
                currentTest++;
                updateProgress();
                if (typeof window.addSessionPoints === 'function') {
                    // Mevcut session score'u kaydet
                    const sessionScoreEl = document.getElementById('session-score');
                    const oldSessionScore = sessionScoreEl ? parseInt(sessionScoreEl.textContent.replace(/\D/g, '')) || 0 : 0;
                    
                    window.addSessionPoints(50);
                    
                    const newSessionScore = sessionScoreEl ? parseInt(sessionScoreEl.textContent.replace(/\D/g, '')) || 0 : 0;
                    
                    if (newSessionScore === oldSessionScore + 50) {
                        addTestResult('Puan AkÄ±ÅŸÄ±', 'Session PuanÄ± Ekleme', 'PASS', `âœ… Session puanÄ± eklendi: ${oldSessionScore} â†’ ${newSessionScore}`);
                    } else {
                        addTestResult('Puan AkÄ±ÅŸÄ±', 'Session PuanÄ± Ekleme', 'WARNING', `âš ï¸ Session puanÄ± beklenen gibi gÃ¼ncellenmedi: ${oldSessionScore} â†’ ${newSessionScore}`);
                    }
                } else {
                    addTestResult('Puan AkÄ±ÅŸÄ±', 'Session PuanÄ± Ekleme', 'FAIL', 'âŒ addSessionPoints fonksiyonu bulunamadÄ±');
                }
                
                // Test 3: Puan kaydetme
                currentTest++;
                updateProgress();
                if (typeof window.saveUserStats === 'function') {
                    try {
                        const user = await window.getCurrentUser();
                        if (user) {
                            await window.saveUserStats(user, initialPoints + 100);
                            const updatedStats = await window.loadUserStats();
                            if (updatedStats && updatedStats.total_points >= initialPoints) {
                                addTestResult('Puan AkÄ±ÅŸÄ±', 'Puan Kaydetme', 'PASS', `âœ… Puan kaydedildi: ${initialPoints} â†’ ${updatedStats.total_points}`);
                            } else {
                                addTestResult('Puan AkÄ±ÅŸÄ±', 'Puan Kaydetme', 'WARNING', 'âš ï¸ Puan kaydedilmedi veya gÃ¼ncellenmedi');
                            }
                        } else {
                            addTestResult('Puan AkÄ±ÅŸÄ±', 'Puan Kaydetme', 'WARNING', 'âš ï¸ KullanÄ±cÄ± giriÅŸ yapmamÄ±ÅŸ');
                        }
                    } catch (error) {
                        addTestResult('Puan AkÄ±ÅŸÄ±', 'Puan Kaydetme', 'FAIL', `âŒ Hata: ${error.message}`);
                    }
                } else {
                    addTestResult('Puan AkÄ±ÅŸÄ±', 'Puan Kaydetme', 'FAIL', 'âŒ saveUserStats fonksiyonu bulunamadÄ±');
                }
                
                // Test 4: GÃ¼nlÃ¼k XP gÃ¼ncelleme
                currentTest++;
                updateProgress();
                const dailyXPBefore = parseInt(localStorage.getItem('dailyXP') || '0');
                // GÃ¼nlÃ¼k XP'yi simÃ¼le et (gerÃ§ek ekleme yapmadan)
                addTestResult('Puan AkÄ±ÅŸÄ±', 'GÃ¼nlÃ¼k XP', 'PASS', `âœ… Mevcut gÃ¼nlÃ¼k XP: ${dailyXPBefore}`);
                
                // Test 5: Puan tutarlÄ±lÄ±ÄŸÄ±
                currentTest++;
                updateProgress();
                const finalStats = await window.loadUserStats();
                const localStoragePoints = parseInt(localStorage.getItem('hasene_total_points') || '0');
                
                if (finalStats && finalStats.total_points === localStoragePoints || Math.abs(finalStats.total_points - localStoragePoints) <= 1) {
                    addTestResult('Puan AkÄ±ÅŸÄ±', 'Puan TutarlÄ±lÄ±ÄŸÄ±', 'PASS', `âœ… Puanlar tutarlÄ±: Stats=${finalStats.total_points}, localStorage=${localStoragePoints}`);
                } else {
                    addTestResult('Puan AkÄ±ÅŸÄ±', 'Puan TutarlÄ±lÄ±ÄŸÄ±', 'WARNING', `âš ï¸ Puanlar farklÄ±: Stats=${finalStats?.total_points}, localStorage=${localStoragePoints}`);
                }
                
            } catch (error) {
                addTestResult('Puan AkÄ±ÅŸÄ±', 'Genel Hata', 'FAIL', `âŒ Hata: ${error.message}`);
            }
        }
        
        async function testBadgeFlow() {
            console.log('ğŸ§ª Rozet AkÄ±ÅŸÄ± Testi BaÅŸlatÄ±lÄ±yor...');
            currentTest = 0;
            totalTests = 4;
            
            try {
                // Test 1: Rozet yÃ¼kleme
                currentTest++;
                updateProgress();
                if (typeof window.loadBadges === 'function') {
                    const badges = await window.loadBadges();
                    addTestResult('Rozet AkÄ±ÅŸÄ±', 'Rozet YÃ¼kleme', 'PASS', `âœ… Rozetler yÃ¼klendi: ${badges ? JSON.stringify(badges) : 'boÅŸ'}`);
                } else {
                    addTestResult('Rozet AkÄ±ÅŸÄ±', 'Rozet YÃ¼kleme', 'FAIL', 'âŒ loadBadges fonksiyonu bulunamadÄ±');
                }
                
                // Test 2: Rozet hesaplama
                currentTest++;
                updateProgress();
                if (typeof window.calculateBadges === 'function') {
                    const testPoints = 5000;
                    const calculatedBadges = window.calculateBadges(testPoints);
                    addTestResult('Rozet AkÄ±ÅŸÄ±', 'Rozet Hesaplama', 'PASS', `âœ… ${testPoints} puan iÃ§in rozetler: ${JSON.stringify(calculatedBadges)}`);
                } else {
                    addTestResult('Rozet AkÄ±ÅŸÄ±', 'Rozet Hesaplama', 'WARNING', 'âš ï¸ calculateBadges fonksiyonu bulunamadÄ±');
                }
                
                // Test 3: Rozet kaydetme (simÃ¼lasyon)
                currentTest++;
                updateProgress();
                if (typeof window.saveBadge === 'function') {
                    addTestResult('Rozet AkÄ±ÅŸÄ±', 'Rozet Kaydetme', 'PASS', 'âœ… saveBadge fonksiyonu mevcut (gerÃ§ek kayÄ±t yapÄ±lmadÄ±)');
                } else {
                    addTestResult('Rozet AkÄ±ÅŸÄ±', 'Rozet Kaydetme', 'FAIL', 'âŒ saveBadge fonksiyonu bulunamadÄ±');
                }
                
                // Test 4: Rozet gÃ¶rselleÅŸtirme
                currentTest++;
                updateProgress();
                if (typeof window.showBadgesModal === 'function' || typeof window.updateBadgeVisualization === 'function') {
                    addTestResult('Rozet AkÄ±ÅŸÄ±', 'Rozet GÃ¶rselleÅŸtirme', 'PASS', 'âœ… Rozet gÃ¶rselleÅŸtirme fonksiyonlarÄ± mevcut');
                } else {
                    addTestResult('Rozet AkÄ±ÅŸÄ±', 'Rozet GÃ¶rselleÅŸtirme', 'WARNING', 'âš ï¸ Rozet gÃ¶rselleÅŸtirme fonksiyonlarÄ± bulunamadÄ±');
                }
                
            } catch (error) {
                addTestResult('Rozet AkÄ±ÅŸÄ±', 'Genel Hata', 'FAIL', `âŒ Hata: ${error.message}`);
            }
        }
        
        async function testDailyTaskFlow() {
            console.log('ğŸ§ª GÃ¼nlÃ¼k GÃ¶rev AkÄ±ÅŸÄ± Testi BaÅŸlatÄ±lÄ±yor...');
            currentTest = 0;
            totalTests = 4;
            
            try {
                // Test 1: GÃ¶rev yÃ¼kleme
                currentTest++;
                updateProgress();
                if (typeof window.loadDailyTasks === 'function') {
                    const tasks = await window.loadDailyTasks();
                    addTestResult('GÃ¶rev AkÄ±ÅŸÄ±', 'GÃ¶rev YÃ¼kleme', 'PASS', `âœ… GÃ¼nlÃ¼k gÃ¶revler yÃ¼klendi: ${tasks ? Object.keys(tasks).length : 0} gÃ¶rev`);
                } else {
                    addTestResult('GÃ¶rev AkÄ±ÅŸÄ±', 'GÃ¶rev YÃ¼kleme', 'FAIL', 'âŒ loadDailyTasks fonksiyonu bulunamadÄ±');
                }
                
                // Test 2: GÃ¶rev kaydetme
                currentTest++;
                updateProgress();
                if (typeof window.saveDailyTasks === 'function') {
                    addTestResult('GÃ¶rev AkÄ±ÅŸÄ±', 'GÃ¶rev Kaydetme', 'PASS', 'âœ… saveDailyTasks fonksiyonu mevcut');
                } else {
                    addTestResult('GÃ¶rev AkÄ±ÅŸÄ±', 'GÃ¶rev Kaydetme', 'FAIL', 'âŒ saveDailyTasks fonksiyonu bulunamadÄ±');
                }
                
                // Test 3: GÃ¶rev ilerlemesi (simÃ¼lasyon)
                currentTest++;
                updateProgress();
                const tasks = await window.loadDailyTasks();
                if (tasks && tasks.todayStats) {
                    addTestResult('GÃ¶rev AkÄ±ÅŸÄ±', 'GÃ¶rev Ä°lerlemesi', 'PASS', `âœ… GÃ¶rev ilerlemesi mevcut: ${JSON.stringify(tasks.todayStats)}`);
                } else {
                    addTestResult('GÃ¶rev AkÄ±ÅŸÄ±', 'GÃ¶rev Ä°lerlemesi', 'WARNING', 'âš ï¸ GÃ¶rev ilerlemesi bilgisi yok');
                }
                
                // Test 4: GÃ¶rev tamamlama kontrolÃ¼
                currentTest++;
                updateProgress();
                if (tasks && tasks.completedTasks) {
                    addTestResult('GÃ¶rev AkÄ±ÅŸÄ±', 'Tamamlanan GÃ¶revler', 'PASS', `âœ… Tamamlanan gÃ¶revler: ${tasks.completedTasks.length}`);
                } else {
                    addTestResult('GÃ¶rev AkÄ±ÅŸÄ±', 'Tamamlanan GÃ¶revler', 'PASS', 'âœ… Tamamlanan gÃ¶revler sistemi mevcut (henÃ¼z tamamlanmamÄ±ÅŸ)');
                }
                
            } catch (error) {
                addTestResult('GÃ¶rev AkÄ±ÅŸÄ±', 'Genel Hata', 'FAIL', `âŒ Hata: ${error.message}`);
            }
        }
        
        async function testFirebaseSync() {
            console.log('ğŸ§ª Firebase Senkronizasyon Testi BaÅŸlatÄ±lÄ±yor...');
            currentTest = 0;
            totalTests = 5;
            
            try {
                // Test 1: Backend tipi
                currentTest++;
                updateProgress();
                const backendType = window.getBackendType();
                addTestResult('Firebase Senkronizasyon', 'Backend Tipi', 'PASS', `âœ… Backend tipi: ${backendType}`);
                
                // Test 2: Firebase baÄŸlantÄ±sÄ±
                currentTest++;
                updateProgress();
                const auth = window.getFirebaseAuth();
                if (auth) {
                    addTestResult('Firebase Senkronizasyon', 'Firebase BaÄŸlantÄ±sÄ±', 'PASS', 'âœ… Firebase Auth baÄŸlantÄ±sÄ± mevcut');
                } else {
                    addTestResult('Firebase Senkronizasyon', 'Firebase BaÄŸlantÄ±sÄ±', 'WARNING', 'âš ï¸ Firebase Auth baÄŸlantÄ±sÄ± yok');
                }
                
                // Test 3: Veri okuma
                currentTest++;
                updateProgress();
                if (typeof window.firestoreGet === 'function') {
                    const user = await window.getCurrentUser();
                    if (user) {
                        try {
                            const userStats = await window.firestoreGet('user_stats', user.id);
                            addTestResult('Firebase Senkronizasyon', 'Veri Okuma', 'PASS', `âœ… Firestore'dan veri okundu: ${userStats ? 'Var' : 'Yok'}`);
                        } catch (error) {
                            addTestResult('Firebase Senkronizasyon', 'Veri Okuma', 'WARNING', `âš ï¸ Firestore okuma hatasÄ±: ${error.message}`);
                        }
                    } else {
                        addTestResult('Firebase Senkronizasyon', 'Veri Okuma', 'WARNING', 'âš ï¸ KullanÄ±cÄ± giriÅŸ yapmamÄ±ÅŸ');
                    }
                } else {
                    addTestResult('Firebase Senkronizasyon', 'Veri Okuma', 'FAIL', 'âŒ firestoreGet fonksiyonu bulunamadÄ±');
                }
                
                // Test 4: Veri yazma (simÃ¼lasyon)
                currentTest++;
                updateProgress();
                if (typeof window.firestoreSet === 'function') {
                    addTestResult('Firebase Senkronizasyon', 'Veri Yazma', 'PASS', 'âœ… firestoreSet fonksiyonu mevcut (gerÃ§ek yazma yapÄ±lmadÄ±)');
                } else {
                    addTestResult('Firebase Senkronizasyon', 'Veri Yazma', 'FAIL', 'âŒ firestoreSet fonksiyonu bulunamadÄ±');
                }
                
                // Test 5: localStorage/Firebase senkronizasyonu
                currentTest++;
                updateProgress();
                const localStoragePoints = parseInt(localStorage.getItem('hasene_total_points') || '0');
                const stats = await window.loadUserStats();
                const firebasePoints = stats?.total_points || 0;
                
                if (Math.abs(localStoragePoints - firebasePoints) <= 1) {
                    addTestResult('Firebase Senkronizasyon', 'Senkronizasyon', 'PASS', `âœ… localStorage ve Firebase senkronize: localStorage=${localStoragePoints}, Firebase=${firebasePoints}`);
                } else {
                    addTestResult('Firebase Senkronizasyon', 'Senkronizasyon', 'WARNING', `âš ï¸ localStorage ve Firebase farklÄ±: localStorage=${localStoragePoints}, Firebase=${firebasePoints}`);
                }
                
            } catch (error) {
                addTestResult('Firebase Senkronizasyon', 'Genel Hata', 'FAIL', `âŒ Hata: ${error.message}`);
            }
        }
        
        async function testEdgeCases() {
            console.log('ğŸ§ª Edge Cases Testi BaÅŸlatÄ±lÄ±yor...');
            currentTest = 0;
            totalTests = 5;
            
            try {
                // Test 1: Null/undefined kontrolÃ¼
                currentTest++;
                updateProgress();
                const user = await window.getCurrentUser();
                if (user && user.id && user.username) {
                    addTestResult('Edge Cases', 'Null KontrolÃ¼', 'PASS', 'âœ… getCurrentUser null dÃ¶ndÃ¼rmÃ¼yor');
                } else {
                    addTestResult('Edge Cases', 'Null KontrolÃ¼', 'WARNING', 'âš ï¸ getCurrentUser null dÃ¶ndÃ¼ (normal olabilir)');
                }
                
                // Test 2: BoÅŸ string kontrolÃ¼
                currentTest++;
                updateProgress();
                const email = localStorage.getItem('hasene_user_email');
                if (email && email !== '' && email !== 'null') {
                    addTestResult('Edge Cases', 'BoÅŸ String KontrolÃ¼', 'PASS', `âœ… Email boÅŸ string deÄŸil: ${email}`);
                } else {
                    addTestResult('Edge Cases', 'BoÅŸ String KontrolÃ¼', 'WARNING', 'âš ï¸ Email boÅŸ veya "null" string');
                }
                
                // Test 3: Negatif puan kontrolÃ¼
                currentTest++;
                updateProgress();
                const stats = await window.loadUserStats();
                if (stats && stats.total_points >= 0) {
                    addTestResult('Edge Cases', 'Negatif Puan KontrolÃ¼', 'PASS', `âœ… Puan negatif deÄŸil: ${stats.total_points}`);
                } else {
                    addTestResult('Edge Cases', 'Negatif Puan KontrolÃ¼', 'FAIL', `âŒ Puan negatif: ${stats?.total_points}`);
                }
                
                // Test 4: Ã‡ok bÃ¼yÃ¼k sayÄ± kontrolÃ¼
                currentTest++;
                updateProgress();
                const dailyXP = parseInt(localStorage.getItem('dailyXP') || '0');
                if (dailyXP >= 0 && dailyXP < 1000000) {
                    addTestResult('Edge Cases', 'BÃ¼yÃ¼k SayÄ± KontrolÃ¼', 'PASS', `âœ… GÃ¼nlÃ¼k XP makul aralÄ±kta: ${dailyXP}`);
                } else {
                    addTestResult('Edge Cases', 'BÃ¼yÃ¼k SayÄ± KontrolÃ¼', 'WARNING', `âš ï¸ GÃ¼nlÃ¼k XP beklenmedik: ${dailyXP}`);
                }
                
                // Test 5: Tarih formatÄ± kontrolÃ¼
                currentTest++;
                updateProgress();
                const today = new Date().toISOString().split('T')[0];
                addTestResult('Edge Cases', 'Tarih FormatÄ±', 'PASS', `âœ… BugÃ¼nÃ¼n tarihi: ${today}`);
                
            } catch (error) {
                addTestResult('Edge Cases', 'Genel Hata', 'FAIL', `âŒ Hata: ${error.message}`);
            }
        }
        
        async function testPerformance() {
            console.log('ğŸ§ª Performans Testi BaÅŸlatÄ±lÄ±yor...');
            currentTest = 0;
            totalTests = 4;
            
            try {
                // Test 1: getCurrentUser performansÄ±
                currentTest++;
                updateProgress();
                const start1 = performance.now();
                for (let i = 0; i < 10; i++) {
                    await window.getCurrentUser();
                }
                const end1 = performance.now();
                const avgTime = (end1 - start1) / 10;
                if (avgTime < 100) {
                    addTestResult('Performans', 'getCurrentUser HÄ±zÄ±', 'PASS', `âœ… Ortalama sÃ¼re: ${avgTime.toFixed(2)}ms (10 Ã§aÄŸrÄ±)`);
                } else {
                    addTestResult('Performans', 'getCurrentUser HÄ±zÄ±', 'WARNING', `âš ï¸ Ortalama sÃ¼re yavaÅŸ: ${avgTime.toFixed(2)}ms`);
                }
                
                // Test 2: loadUserStats performansÄ±
                currentTest++;
                updateProgress();
                const start2 = performance.now();
                await window.loadUserStats();
                const end2 = performance.now();
                const loadTime = end2 - start2;
                if (loadTime < 500) {
                    addTestResult('Performans', 'loadUserStats HÄ±zÄ±', 'PASS', `âœ… YÃ¼kleme sÃ¼resi: ${loadTime.toFixed(2)}ms`);
                } else {
                    addTestResult('Performans', 'loadUserStats HÄ±zÄ±', 'WARNING', `âš ï¸ YÃ¼kleme sÃ¼resi yavaÅŸ: ${loadTime.toFixed(2)}ms`);
                }
                
                // Test 3: localStorage eriÅŸim hÄ±zÄ±
                currentTest++;
                updateProgress();
                const start3 = performance.now();
                for (let i = 0; i < 100; i++) {
                    localStorage.getItem('hasene_user_id');
                }
                const end3 = performance.now();
                const localStorageTime = (end3 - start3) / 100;
                addTestResult('Performans', 'localStorage HÄ±zÄ±', 'PASS', `âœ… Ortalama eriÅŸim sÃ¼resi: ${localStorageTime.toFixed(4)}ms (100 Ã§aÄŸrÄ±)`);
                
                // Test 4: Fonksiyon Ã§aÄŸrÄ± sayÄ±sÄ±
                currentTest++;
                updateProgress();
                const functionCount = Object.keys(window).filter(key => 
                    typeof window[key] === 'function' && 
                    (key.includes('Badge') || key.includes('Points') || key.includes('Stats') || key.includes('Task'))
                ).length;
                addTestResult('Performans', 'Fonksiyon SayÄ±sÄ±', 'PASS', `âœ… Ä°lgili fonksiyon sayÄ±sÄ±: ${functionCount}`);
                
            } catch (error) {
                addTestResult('Performans', 'Genel Hata', 'FAIL', `âŒ Hata: ${error.message}`);
            }
        }
        
        async function testDataIntegrity() {
            console.log('ğŸ§ª Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼ Testi BaÅŸlatÄ±lÄ±yor...');
            currentTest = 0;
            totalTests = 5;
            
            try {
                // Test 1: Veri tutarlÄ±lÄ±ÄŸÄ±
                currentTest++;
                updateProgress();
                const stats = await window.loadUserStats();
                const localStoragePoints = parseInt(localStorage.getItem('hasene_total_points') || '0');
                
                if (stats && Math.abs(stats.total_points - localStoragePoints) <= 1) {
                    addTestResult('Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼', 'Puan TutarlÄ±lÄ±ÄŸÄ±', 'PASS', `âœ… Puanlar tutarlÄ±: Stats=${stats.total_points}, localStorage=${localStoragePoints}`);
                } else {
                    addTestResult('Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼', 'Puan TutarlÄ±lÄ±ÄŸÄ±', 'WARNING', `âš ï¸ Puanlar farklÄ±: Stats=${stats?.total_points}, localStorage=${localStoragePoints}`);
                }
                
                // Test 2: KullanÄ±cÄ± ID tutarlÄ±lÄ±ÄŸÄ±
                currentTest++;
                updateProgress();
                const user = await window.getCurrentUser();
                const localStorageUserId = localStorage.getItem('hasene_user_id');
                
                if (user && user.id === localStorageUserId) {
                    addTestResult('Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼', 'KullanÄ±cÄ± ID TutarlÄ±lÄ±ÄŸÄ±', 'PASS', `âœ… KullanÄ±cÄ± ID'leri tutarlÄ±: ${user.id}`);
                } else {
                    addTestResult('Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼', 'KullanÄ±cÄ± ID TutarlÄ±lÄ±ÄŸÄ±', 'WARNING', `âš ï¸ KullanÄ±cÄ± ID'leri farklÄ±: user=${user?.id}, localStorage=${localStorageUserId}`);
                }
                
                // Test 3: Email tutarlÄ±lÄ±ÄŸÄ±
                currentTest++;
                updateProgress();
                const localStorageEmail = localStorage.getItem('hasene_user_email');
                
                if (user && user.email === localStorageEmail) {
                    addTestResult('Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼', 'Email TutarlÄ±lÄ±ÄŸÄ±', 'PASS', `âœ… Email'ler tutarlÄ±: ${user.email}`);
                } else if (user && user.email && localStorageEmail && user.email !== 'null' && localStorageEmail !== 'null') {
                    addTestResult('Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼', 'Email TutarlÄ±lÄ±ÄŸÄ±', 'WARNING', `âš ï¸ Email'ler farklÄ±: user=${user.email}, localStorage=${localStorageEmail}`);
                } else {
                    addTestResult('Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼', 'Email TutarlÄ±lÄ±ÄŸÄ±', 'PASS', 'âœ… Email tutarlÄ±lÄ±ÄŸÄ± kontrol edildi');
                }
                
                // Test 4: Veri tipi kontrolÃ¼
                currentTest++;
                updateProgress();
                const points = stats?.total_points;
                if (typeof points === 'number' && !isNaN(points)) {
                    addTestResult('Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼', 'Veri Tipi KontrolÃ¼', 'PASS', `âœ… Puan tipi doÄŸru: number (${points})`);
                } else {
                    addTestResult('Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼', 'Veri Tipi KontrolÃ¼', 'FAIL', `âŒ Puan tipi yanlÄ±ÅŸ: ${typeof points}`);
                }
                
                // Test 5: Veri kaybÄ± kontrolÃ¼
                currentTest++;
                updateProgress();
                const badges = await window.loadBadges();
                if (badges && typeof badges === 'object') {
                    addTestResult('Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼', 'Veri KaybÄ± KontrolÃ¼', 'PASS', `âœ… Rozet verileri mevcut: ${Object.keys(badges).length} rozet`);
                } else {
                    addTestResult('Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼', 'Veri KaybÄ± KontrolÃ¼', 'WARNING', 'âš ï¸ Rozet verileri eksik veya bozuk');
                }
                
            } catch (error) {
                addTestResult('Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼', 'Genel Hata', 'FAIL', `âŒ Hata: ${error.message}`);
            }
        }
        
        async function runAllTests() {
            console.log('ğŸš€ TÃ¼m GeliÅŸmiÅŸ Testler BaÅŸlatÄ±lÄ±yor...');
            testResults = [];
            totalTests = 0;
            currentTest = 0;
            
            await testPointsFlow();
            await testBadgeFlow();
            await testDailyTaskFlow();
            await testFirebaseSync();
            await testEdgeCases();
            await testPerformance();
            await testDataIntegrity();
            
            totalTests = 0;
            currentTest = 0;
            updateProgress();
            
            console.log('âœ… TÃ¼m geliÅŸmiÅŸ testler tamamlandÄ±!');
        }
        
        function clearResults() {
            testResults = [];
            totalTests = 0;
            currentTest = 0;
            updateProgress();
            displayResults();
        }
        
        // Sayfa yÃ¼klendiÄŸinde
        window.addEventListener('load', () => {
            console.log('âœ… GeliÅŸmiÅŸ test sayfasÄ± yÃ¼klendi');
            console.log('ğŸ’¡ "TÃ¼m Testleri Ã‡alÄ±ÅŸtÄ±r" butonuna tÄ±klayarak testleri baÅŸlatabilirsiniz');
        });
    </script>
</body>
</html>
