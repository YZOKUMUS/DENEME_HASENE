<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>getCurrentUser() Test Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #764ba2;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: #764ba2;
            color: white;
        }
        
        .btn-secondary {
            background: #667eea;
            color: white;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .test-results {
            margin-top: 30px;
        }
        
        .test-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            background: #f8f9fa;
            border-left: 4px solid #ddd;
        }
        
        .test-item.pass {
            border-left-color: #10b981;
            background: #d1fae5;
        }
        
        .test-item.fail {
            border-left-color: #ef4444;
            background: #fee2e2;
        }
        
        .test-item.warning {
            border-left-color: #f59e0b;
            background: #fef3c7;
        }
        
        .test-name {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 8px;
        }
        
        .test-details {
            font-size: 14px;
            color: #666;
            margin-top: 8px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            background: rgba(0,0,0,0.05);
            padding: 10px;
            border-radius: 4px;
        }
        
        .summary {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª getCurrentUser() Test Suite</h1>
        <p class="subtitle">KullanÄ±cÄ± bilgileri ve localStorage testleri</p>
        
        <div class="test-controls">
            <button class="btn-primary" onclick="runAllTests()">ğŸš€ TÃ¼m Testleri Ã‡alÄ±ÅŸtÄ±r</button>
            <button class="btn-secondary" onclick="clearResults()">ğŸ—‘ï¸ SonuÃ§larÄ± Temizle</button>
            <button class="btn-success" onclick="testGetCurrentUser()">ğŸ‘¤ getCurrentUser() Testi</button>
            <button class="btn-success" onclick="testLocalStorage()">ğŸ’¾ localStorage Testi</button>
            <button class="btn-success" onclick="testEmailNull()">ğŸ“§ Email 'null' Testi</button>
        </div>
        
        <div id="test-results" class="test-results">
            <p style="color: #666;">Testleri baÅŸlatmak iÃ§in yukarÄ±daki butonlardan birine tÄ±klayÄ±n.</p>
        </div>
    </div>
    
    <!-- Ana proje dosyalarÄ±nÄ± yÃ¼kle -->
    <script src="js/config.js"></script>
    <script src="js/constants.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/firebase-config.js"></script>
    <script type="module" src="js/firebase-init.js"></script>
    <script src="js/api-service.js"></script>
    
    <script>
        let testResults = [];
        
        function addTestResult(name, status, details) {
            testResults.push({ name, status, details, timestamp: new Date() });
            displayResults();
        }
        
        function displayResults() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';
            
            if (testResults.length === 0) {
                resultsDiv.innerHTML = '<p style="color: #666;">HenÃ¼z test Ã§alÄ±ÅŸtÄ±rÄ±lmadÄ±.</p>';
                return;
            }
            
            testResults.forEach(result => {
                const itemDiv = document.createElement('div');
                itemDiv.className = `test-item ${result.status.toLowerCase()}`;
                
                const icon = result.status === 'PASS' ? 'âœ…' : 
                            result.status === 'WARNING' ? 'âš ï¸' : 'âŒ';
                
                itemDiv.innerHTML = `
                    <div class="test-name">${icon} ${result.name}</div>
                    <div class="test-details">${result.details}</div>
                `;
                
                resultsDiv.appendChild(itemDiv);
            });
            
            // Ã–zet istatistikler
            const stats = {
                total: testResults.length,
                passed: testResults.filter(r => r.status === 'PASS').length,
                failed: testResults.filter(r => r.status === 'FAIL').length,
                warnings: testResults.filter(r => r.status === 'WARNING').length
            };
            
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'summary';
            const successRate = stats.total > 0 
                ? Math.round((stats.passed / stats.total) * 100)
                : 0;
            
            summaryDiv.innerHTML = `
                <h3>ğŸ“Š Ã–zet Ä°statistikler</h3>
                <div class="summary-stats">
                    <div class="stat-item">
                        <div class="stat-value">${stats.total}</div>
                        <div class="stat-label">Toplam Test</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #10b981;">${stats.passed}</div>
                        <div class="stat-label">âœ… BaÅŸarÄ±lÄ±</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #f59e0b;">${stats.warnings}</div>
                        <div class="stat-label">âš ï¸ UyarÄ±</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #ef4444;">${stats.failed}</div>
                        <div class="stat-label">âŒ BaÅŸarÄ±sÄ±z</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${successRate}%</div>
                        <div class="stat-label">ğŸ“Š BaÅŸarÄ± OranÄ±</div>
                    </div>
                </div>
            `;
            
            resultsDiv.appendChild(summaryDiv);
        }
        
        async function testGetCurrentUser() {
            console.log('ğŸ§ª getCurrentUser() Testi BaÅŸlatÄ±lÄ±yor...');
            
            try {
                // Test 1: Fonksiyon var mÄ±?
                if (typeof window.getCurrentUser !== 'function') {
                    addTestResult(
                        'getCurrentUser Fonksiyonu KontrolÃ¼',
                        'FAIL',
                        'âŒ window.getCurrentUser fonksiyonu bulunamadÄ±!'
                    );
                    return;
                }
                
                addTestResult(
                    'getCurrentUser Fonksiyonu KontrolÃ¼',
                    'PASS',
                    'âœ… window.getCurrentUser fonksiyonu mevcut'
                );
                
                // Test 2: Fonksiyon Ã§aÄŸrÄ±sÄ±
                const user = await window.getCurrentUser();
                
                if (!user) {
                    addTestResult(
                        'getCurrentUser() Ã‡aÄŸrÄ±sÄ±',
                        'WARNING',
                        'âš ï¸ Fonksiyon null dÃ¶ndÃ¼ (kullanÄ±cÄ± giriÅŸ yapmamÄ±ÅŸ olabilir)'
                    );
                } else {
                    const details = `âœ… KullanÄ±cÄ± bilgileri alÄ±ndÄ±:\n` +
                        `   ID: ${user.id}\n` +
                        `   Username: ${user.username}\n` +
                        `   Email: ${user.email}`;
                    
                    addTestResult(
                        'getCurrentUser() Ã‡aÄŸrÄ±sÄ±',
                        'PASS',
                        details
                    );
                    
                    // Test 3: Email 'null' kontrolÃ¼
                    if (user.email === 'null' || user.email === null) {
                        addTestResult(
                            'Email DeÄŸeri KontrolÃ¼',
                            'FAIL',
                            `âŒ Email hala 'null' veya null! DeÄŸer: ${user.email}`
                        );
                    } else if (user.email && user.email.includes('@')) {
                        addTestResult(
                            'Email DeÄŸeri KontrolÃ¼',
                            'PASS',
                            `âœ… Email dÃ¼zgÃ¼n: ${user.email}`
                        );
                    } else {
                        addTestResult(
                            'Email DeÄŸeri KontrolÃ¼',
                            'WARNING',
                            `âš ï¸ Email formatÄ± beklenmedik: ${user.email}`
                        );
                    }
                    
                    // Test 4: TutarlÄ±lÄ±k testi (3 kez Ã§aÄŸÄ±r)
                    const results = [];
                    for (let i = 0; i < 3; i++) {
                        const u = await window.getCurrentUser();
                        results.push(u);
                    }
                    
                    const allSame = results.every(r => 
                        r && r.id === user.id && 
                        r.username === user.username && 
                        r.email === user.email
                    );
                    
                    if (allSame) {
                        addTestResult(
                            'TutarlÄ±lÄ±k Testi (3 Ã‡aÄŸrÄ±)',
                            'PASS',
                            'âœ… TÃ¼m Ã§aÄŸrÄ±lar aynÄ± sonucu dÃ¶ndÃ¼'
                        );
                    } else {
                        addTestResult(
                            'TutarlÄ±lÄ±k Testi (3 Ã‡aÄŸrÄ±)',
                            'FAIL',
                            `âŒ FarklÄ± sonuÃ§lar dÃ¶ndÃ¼:\n${JSON.stringify(results, null, 2)}`
                        );
                    }
                }
                
            } catch (error) {
                addTestResult(
                    'getCurrentUser() Hata KontrolÃ¼',
                    'FAIL',
                    `âŒ Hata oluÅŸtu: ${error.message}\n${error.stack}`
                );
            }
        }
        
        async function testLocalStorage() {
            console.log('ğŸ§ª localStorage Testi BaÅŸlatÄ±lÄ±yor...');
            
            try {
                const userId = localStorage.getItem('hasene_user_id');
                const username = localStorage.getItem('hasene_username');
                const email = localStorage.getItem('hasene_user_email');
                
                const details = `localStorage DeÄŸerleri:\n` +
                    `   hasene_user_id: ${userId || '(yok)'}\n` +
                    `   hasene_username: ${username || '(yok)'}\n` +
                    `   hasene_user_email: ${email || '(yok)'}`;
                
                // Email 'null' string kontrolÃ¼
                if (email === 'null') {
                    addTestResult(
                        'localStorage Email KontrolÃ¼',
                        'FAIL',
                        `âŒ Email 'null' string olarak kaydedilmiÅŸ!`
                    );
                } else if (email && email !== 'null') {
                    addTestResult(
                        'localStorage Email KontrolÃ¼',
                        'PASS',
                        `âœ… Email dÃ¼zgÃ¼n: ${email}`
                    );
                } else {
                    addTestResult(
                        'localStorage Email KontrolÃ¼',
                        'WARNING',
                        `âš ï¸ Email localStorage'da yok`
                    );
                }
                
                addTestResult(
                    'localStorage DeÄŸerleri',
                    userId || username || email ? 'PASS' : 'WARNING',
                    details
                );
                
            } catch (error) {
                addTestResult(
                    'localStorage Testi',
                    'FAIL',
                    `âŒ Hata: ${error.message}`
                );
            }
        }
        
        async function testEmailNull() {
            console.log('ğŸ§ª Email "null" Testi BaÅŸlatÄ±lÄ±yor...');
            
            try {
                // Test 1: localStorage'dan oku
                let email = localStorage.getItem('hasene_user_email');
                const originalEmail = email;
                
                // Test 2: 'null' string'ini kontrol et
                if (email === 'null') {
                    addTestResult(
                        'localStorage "null" String KontrolÃ¼',
                        'FAIL',
                        `âŒ localStorage'da 'null' string'i var!`
                    );
                } else {
                    addTestResult(
                        'localStorage "null" String KontrolÃ¼',
                        'PASS',
                        `âœ… localStorage'da 'null' string'i yok: ${email || '(yok)'}`
                    );
                }
                
                // Test 3: getCurrentUser() ile karÅŸÄ±laÅŸtÄ±r
                const user = await window.getCurrentUser();
                if (user && user.email) {
                    if (user.email === 'null') {
                        addTestResult(
                            'getCurrentUser() Email "null" KontrolÃ¼',
                            'FAIL',
                            `âŒ getCurrentUser() 'null' string dÃ¶ndÃ¼rÃ¼yor!`
                        );
                    } else {
                        addTestResult(
                            'getCurrentUser() Email "null" KontrolÃ¼',
                            'PASS',
                            `âœ… getCurrentUser() dÃ¼zgÃ¼n email dÃ¶ndÃ¼rÃ¼yor: ${user.email}`
                        );
                    }
                }
                
            } catch (error) {
                addTestResult(
                    'Email "null" Testi',
                    'FAIL',
                    `âŒ Hata: ${error.message}`
                );
            }
        }
        
        async function runAllTests() {
            console.log('ğŸš€ TÃ¼m Testler BaÅŸlatÄ±lÄ±yor...');
            testResults = [];
            
            await testGetCurrentUser();
            await testLocalStorage();
            await testEmailNull();
            
            console.log('âœ… TÃ¼m testler tamamlandÄ±!');
        }
        
        function clearResults() {
            testResults = [];
            displayResults();
        }
        
        // Sayfa yÃ¼klendiÄŸinde
        window.addEventListener('load', () => {
            console.log('âœ… Test sayfasÄ± yÃ¼klendi');
            console.log('ğŸ’¡ "TÃ¼m Testleri Ã‡alÄ±ÅŸtÄ±r" butonuna tÄ±klayarak testleri baÅŸlatabilirsiniz');
        });
    </script>
</body>
</html>
